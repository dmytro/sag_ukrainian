%-----------------------------------------------------------------------
\chapter{Створення та керування рахуками користувач╕в}
\label{chap:useradmin}
%-----------------------------------------------------------------------
% $Id: useradmin.tex,v 1.1.1.2 2004-03-22 12:59:26 dmytro Exp $

	\begin{verse}\it
	Чим схож╕ м╕ж собою системн╕ адм╕н╕стратори ╕ торговц╕ \\
	наркотиками: ╕ т╕ й ╕нш╕ вим╕рюють св╕й товар в K, ╕ т╕ й ╕нш╕\\
	мають користувач╕в. (Старий комп'ютерний жарт з бородою).	\\
	\rm\end{verse}

	\noindent
	Цей розд╕л навчить Вас створювати рахунки
	користувач╕в\intnote{user accounts}, як зм╕нювати властивост╕
	цих рахунк╕в ╕ як ╖х стирати. Р╕зн╕ верс╕╖ Л╕накса
	користуються р╕зними засобами для цього.
		
\section{Що таке рахунок?}

	Якщо комп'ютер використову╓ться багатьма, необх╕дно ввести
	деяк╕ в╕дм╕нност╕ м╕ж користувачами цього комп'ютера, з тою
	метою, щоб приватн╕ файли р╕зних користувач╕в не заважали
	особистим файлам ╕нших. Нав╕ть якщо комп'ютер використову╓ться
	т╕льки одним користувачем кожного моменту часу, це варто
	зробити\footnote{Якщо моя сестра буде читати мо╖ осв╕дчення в
	коханн╕, мен╕ не дуже це сподоба╓ться}. Тож кожному з
	користувач╕в присвою╓ться ун╕кальне ╕м'я.  Саме це ╕м'я
	використову╓ться для ре╓страц╕╖ в систем╕.

	Але одного ╕мен╕, звичайно ж, не досить. \defin{Рахунок} - це
	вс╕ файли, ресурси та ╕нформац╕я, що в╕дноситься до певного
	користувача. Терм╕н цей под╕бний до того, який
	використову╓ться в банках, а в банках до ╕мен╕ користувача ще
	прив'язуються певн╕ ф╕нанси асоц╕йован╕ з цим
	╕менем. Швидк╕сть з якою ф╕нанси витрачаються залежить в╕д
	того, наск╕льки активно користувач використову╓ ресурси
	банку. Наприклад, дисковий прост╕р може мати варт╕сть, яка
	обрахову╓ться в ме╜абайтах на день, а обчислювальна потужн╕сть
	може обраховуватись посекундно.
	
\section{Створення користувача}

	Для ядра Л╕накса користувач╕ системи ╓ просто числами. Кожен
	користувач ма╓ св╕й ун╕кальний номер (ц╕ле число), який
	називають \defin{ID користувача}\intnote{user id} або
	\defin{uid}. Для комп'ютера набагато швидше ╕ прост╕ше мати
	справу з числами, н╕ж з текстовими ╕менами. База даних поза
	межами ядра признача╓ кожному ID користувача текстове ╕м'я,
	або \defin{╕м'я користувача}\intnote{username}. Ця база даних
	м╕стить в соб╕ також ╕ ╕ншу ╕нформац╕ю про користувач╕в.

	Щоб створити користувача, Вам потр╕бно додати ╕нформац╕ю про
	цього користувача до бази даних користувач╕в ╕ створити
	домашню директор╕ю для нього. Напевно ще буде потр╕бно навчити
	користувача та створити робоче середовище для нього.
	
	Б╕льш╕сть Л╕накс╕в мають одну або ╕ншу програму для створення
	рахунк╕в користувач╕в. Дв╕ таких програми, що працюють з
	командного рядка - це \fn{adduser} та \fn{useradd}. Можуть
	бути також ╕нш╕ вар╕анти, як╕ працюють з в╕концями та
	керуються мишою. Якою б програмою Ви не користувались, вручну
	залиша╓ться доробити дуже невелику частину роботи. Нав╕ть якщо
	детал╕ роботи програм в╕др╕зняються, вони роблять додання
	нового користувача до системи трив╕альною задачею. Однак,
	розд╕л~\ref{subsec:manual-adduser} розпов╕сть, як можна робити
	все це вручну.
	
	
\subsection{\fn{/etc/passwd} та ╕нш╕ корисн╕ файли}

	Основною базою даних з ╕нформац╕╓ю про користувач╕в в Юн╕кс╕ ╓
	текстовий файл \fn{/etc/passwd} (який називають файлом
	\defin{парол╕в}\intnote{password file}), в якому перел╕чен╕
	вс╕ д╕йсн╕ користувач╕ системи ╕ та ╕нформац╕я, що в╕дноситься до
	них. ╤нформац╕я про кожного користувача записана на одному
	рядку в файл╕, ╕ поля в такому рядку розд╕лен╕
	двокрапками. Кожен рядок ма╓ с╕м таких пол╕в:
		%
		\begin{enumerate}
		\item ╤м'я користувача.
		\item Зашифрований пароль.
		\item ID користувача в числовому вигляд╕.
		\item ID групи користувача в числовому вигляд╕.
		\item Повне ╕м'я користувача та ╕нша ╕нформац╕я про користувача.
		\item Домашня директор╕я.
		\item Командна оболонка (програма, яка викону╓ться при	вход╕ в систему).
		\end{enumerate}
		%
	З б╕льшимим подробицями формат файлу описаний в \man{passwd}(5).

	Будь-який користувач системи може прочитати файл
	парол╕в. Отже, можна побачити повне ╕м'я користувача з цього
	файлу. Це означа╓ також, що пароль (друге поле цього файлу)
	також доступний будь-якому користувачев╕. Парол╕ збер╕гаються
	в закодованому вигляд╕, тож, теоретично, н╕би-то проблеми
	нема╓. Але слабкою стороною систем крипто╜раф╕╖ ╓ те, що ╖х
	можна зламати, особливо якщо пароль погано вибраний.
	Наприклад, якщо пароль короткий або паролем вибране якесь
	слово ╕з словника. Тож, тримати пароль в файл╕ парол╕в не
	рекоменду╓ться.
	
	Багато Л╕накс╕в мають \defin{т╕ньов╕ парол╕}. Це -
	альтернативний спос╕б збер╕гання парол╕в: закодований пароль
	збер╕га╓ться в окремому файл╕ \fn{/etc/shadow}, ╕ цей файл
	доступний для читання т╕льки \texttt{root}'у. Файл
	\fn{/etc/passwd} в цьому випадку м╕стить т╕льки спец╕альн╕
	показники на парол╕ в файл╕ \fn{/etc/shadow} зам╕сть самих
	парол╕в. Таким чином т╕льки т╕ програми, як╕ мають setuid
	можуть перев╕рити файл т╕ньових парол╕в, а вс╕ ╕нш╕ програми
	можуть прочитати вс╕ поля файлу \fn{/etc/passwd}, але не мають
	доступу до файлу \fn{/etc/shadow}\footnote{Так-так, як
	виявля╓ться файл парол╕в тепер ма╓ в соб╕ вс╕ дан╕ про
	користувача \emph{ кр╕м} самого пароля. Незбагненн╕ шляхи
	програмного розвитку.}
	
\subsection{Виб╕р числового ID користувача та ID групи}

	Як правило, Ви можете не турбуватися про числове значення ID
	користувача та номер групи, але якщо Ви збира╓тесь
	користуватися NFS (файловою системою мереж╕), Вам сл╕д
	подбати про те, щоб користувач╕ мали одн╕ й т╕ ж числов╕
	значення ID в ус╕й мереж╕. Через те, що NFS також в╕др╕зня╓
	користувач╕в по числовим значенням ╖хн╕х ID. Якщо в Ваш╕й
	конф╕╜урац╕╖ не присутн╕ NFS сервери, можете покластися на
	програму в вибор╕ значень ID.

	Якщо Ви користу╓тесь NFS, Вам треба винайти певний спос╕б для
	синхрон╕зац╕╖ рахунк╕в користувач╕в на р╕зних системах. Один
	╕з способ╕в поляга╓ в використанн╕ NIS
	(див. \cite{network-admin-guide}). 

	\meta this is wrong place?
	Однак не варто повторно використовувати одн╕ й т╕ ж числа для
	ID (та для ╕мен користувач╕в), бо нов╕ користувач╕ можуть
	отримати доступ до файл╕в попередн╕х.


%\subsection{Managing groups}
%
%	\meta Debian creates a new group for each user; give reason for this;
%	give reasons against.
	
\subsection{Робоче оточення: \fn{/etc/skel}}

	П╕сля створення ново╖ домашньо╖ директор╕╖, ця директор╕я
	наповню╓ться файлами з директор╕╖ \fn{/etc/skel}. Системний
	адм╕н╕стратор може створювати файли в \fn{/etc/skel} як╕
	будуть забезпечувати додаткову конф╕╜урац╕ю для
	користувач╕в. Наприклад, адм╕н╕стратор в файл╕
	\fn{/etc/skel/.profile} може встановити зм╕нну EDITOR, яка
	буде встановлювати редактор, який б╕льш зручний в користуванн╕
	для користувач╕в системи. 

	Однак, варто намагатися п╕дтримувати \fn{/etc/skel}
	м╕н╕мального розм╕ру, оск╕льки п╕сля буде практично неможливо
	коригувати вже ╕снуюч╕ файли користувач╕в. Наприклад, якщо
	назва редактора зм╕ню╓ться, вс╕ користувач╕ повинн╕ будуть
	в╕дредагувати сво╖ \fn{.profile} файли. Звичайно ж,
	адм╕н╕стратор може намагатися зробити це за допомогою скрипта,
	тобто автоматично, але, напевне, це порушить лог╕ку роботи
	чийогось файлу\begin{intnote}
%
	Я цього не писав. Я всього навсього перекладач. ╤нколи в
	в╕льний в╕д переклад╕в час, потроху займаютсь системною
	адм╕н╕страц╕╓ю, за що ╕ отримую грош╕ на св╕й хл╕б.

	Взагал╕ керування робочими середовищами користувач╕в
	заслугову╓ на окрему книжку. Стандарт╕в в ц╕й област╕ нема╓,
	н╕хто не присвячу╓ ц╕й тем╕ жодних ессе, мемуар╕в... А в цей
	час страждають беззахисн╕ користувач╕. Але част╕ше
	трапля╓ться, що страждають в╕д цього саме системн╕
	адм╕н╕стратори, - хто його зна╓, як╕ можуть бути користувач╕?
	Взагал╕ кажучи "<порушення лог╕ки роботи файлу користувача">
	занадто сильний вираз, сила якого може в деяких випадках може
	переважувати варт╕сть позиц╕╖ системного адм╕н╕стратора з
	ус╕ма вит╕каючими зв╕дси результатами.

	Тож щоб порушути табу мовчання в ц╕й област╕... Якщо Ваша
	орган╕зац╕я ма╓ дуже багато користувач╕в (я маю на уваз╕
	"<\emph{ дуже} багато">), то скор╕ше всього вони будуть
	лог╕чно б╕льш-менш д╕лим╕ на певн╕ групи, тобто: "<професори">
	та "<студенти"> чи "<хакери"> та "<бугалтери ╕ завгоспи">. Тож
	можна замислитися над питанням: "<А чи варто взагал╕ бугалтерам
	та завгоспам давати доступ до редагування ╖хн╕х "<персональних">
	\fn{.profile}'╕в? Чи може створити для них один ╓диний
	\fn{/home/ENVIRON/ZAVHOSP/profile} ╕ зробити \fn{~/.profile}
	посиланням (softlink) на цей файл. Для користувач╕в же
	з р╕внем ╕нтелекту вищим в╕д середньо-загально-галузевого
	варто передбачити в \fn{.profile} лог╕ку типу: \fn{[ -x
	\$\{HOME\}/.profile-custom ] \&\& \{ . \$\{HOME\}/.profile-custom\}}

	Ще можу додати, що можливо директор╕я \fn{/etc/skel} зда╓ться
	непоганою ╕де╓ю, але, (з свого власного досв╕ду) т╕льки для систем
	в╕д малих до середн╕х - в╕д одного до п╕в-десятка комп'ютер╕в
	(можливо до десятка, якщо кожен з комп'ютер╕в ма╓ одного-двох
	пост╕йних користувач╕в). Для б╕льших систем користування ц╕╓ю
	директор╕╓ю виявля╓ться непрактичним, якщо \fn{/etc/skel}
	м╕стить б╕льше, н╕ж один-два файли ╕ у переважн╕й б╕льшост╕
	випадк╕в нехту╓ться. \end{intnote}
	
	Коли це т╕льки можливо треба намагатися записувати загальн╕
	системн╕ конф╕╜урац╕╖ в загально-системн╕ файли, так╕, як
	\fn{/etc/profile}. При цьому Ви можете зм╕нювати системн╕
	установки без необх╕дност╕ втручатися в файли користувач╕в. 
	
\subsection{Створення нових користувач╕в вручну}\label{subsec:manual-adduser}

	Щоб створити новий рахунок в систем╕ вручну, виконайте таке: 
		%
	\begin{enumerate}
	\item В╕дредагуйте файл \fn{/etc/passwd} за допомогою команди
		\cmd{vipw}. Будьте уважн╕ з синтаксисом файлу.\emph{ Не
		редагуйте файл безпосередньо якимось редактором}
		Команда \fn{vipw} замика╓ файл \fn{/etc/passwd} так,
		що ╕нш╕ команди не можуть редагувати один ╕ той же
		файл одночасно з Вами. В пол╕ парол╕в файлу поставте
		`\texttt{*}' для того, щоб не можна було
		заре╓струватися в систем╕ з цим рахунком. 
       \item Якщо при створенн╕ рахунку Вам треба також створити нову
		групу, в╕дредагуйте файл \fn{/etc/group} комадною
		\cmd{vigr}. 
	\item Створ╕ть нову домашню директор╕ю для користувача
		командою \cmd{mkdir}.
	\item Скоп╕юйте файли з \fn{/etc/skel} в нову домашню
		директор╕ю. 
	\item В╕дкоригуйте права власност╕ директор╕╖ командами
		\cmd{chown} та \cmd{chmod}. Найб╕льш корисним може
		бути використання параметру \texttt{-R}. В╕д системи
		до системи в╕рн╕ права доступу трохи в╕др╕зняються,
		але звичайно наступна команда - це те що Вам треба: 
			%
\begin{quote}\tt
cd \textsl{/home/newusername} \\
chown -R \textsl{username.group} . \\
chmod -R go=u,go-w . \\
chmod go= .
\rm\end{quote}
			%
	\item За допомогою команди \cmd{passwd} (1) встанов╕ть пароль.
	\end{enumerate}

	П╕сля встановлення паролю цей рахунок буде працювати. Не варто
	встановлювати пароль до того, як зак╕нчено все ╕нше, бо перш,
	н╕ж Ви встигнете зак╕нчити свою роботу, користувач може вже
	заре╓струватися в систем╕. 
	
	╤нколи необх╕дно створювати пуст╕ рахунки\footnote{Не╕снуюч╕
	користувач╕?}, як╕ не використовуються людьми. Наприклад, для
	встановлення сервера FTP з анон╕мним доступом (тобто таким, з
	якого будь-хто може звантажувати файли для себе, не маючи
	рахунку на цьому сервер╕), Вам необх╕дно створити рахунок,
	який назива╓ться \textsl{ftp}. В таких випадках нема╓
	необх╕дност╕ встановлювати пароль (останн╕й крок в попередн╕х
	╕нструкц╕ях). Насправд╕, якщо пароль для такого рахунку не
	встановлено, то н╕хто не зможе заре╓струватися в систем╕ з
	таким ╕менем (щоб перейти в цей рахунок, звичайному
	користувачев╕ треба спочатку стати \texttt{root}, оск╕льки
	\texttt{root} може ставати будь-яким користувачем. 
	
	
%\section{Educating a new user}
%
%	\meta
%	make sure they know how to get help
%	large sites might want to write a small booklet (or even just
%		a couple of pages) with important stuff: how to log in
%		and out, how to change password, which systems there are,
%		how to use mail, list of people that answer questions

\section{Зм╕на властивостей рахунк╕в користувач╕в}

	╢ к╕лька команд, як╕ можуть зм╕нювати р╕зн╕ властивост╕
	рахунк╕в (тобто певн╕ поля в файл╕ \fn{/etc/passwd}):
		%
	\begin{quote}
	\begin{description}
	\item[\cmd{chfn}] Зм╕ню╓ повне ╕м'я користувача.
	\item[\cmd{chsh}] Зм╕ню╓ командну оболонку користувача.
	\item[\cmd{passwd}] Зм╕ню╓ пароль користувача.
	\end{description}
	\end{quote}
		%
	Системний адм╕н╕стратор цими командами може зм╕нювати рахунок
	будь-якого користувача. Звичайн╕ користувач╕ можуть зм╕нювати
	т╕льки сво╖ власн╕ рахунки. Якщо потр╕бно
	заборонити використання цих команд для звичайних користувач╕в,
	наприклад, в систем╕, де дуже багато початк╕вц╕в, це можна
	зробити за допомогою команди \cmd{chmod}.

	Все ╕нше потр╕бно робити сво╖ми власними руками. Наприклад,
	для того, щоб зм╕нити ╕м'я користувача, треба в╕дредагувати
	файл \fn{/etc/passwd} (за допомогою команди \cmd{vipw} -
	пам'ятайте про це!). Так само, для того, щоб додати
	користувач╕в до ╕нших груп, чи, навпаки, виключити з певних
	груп, потр╕бно зм╕нити файл \fn{/etc/group} (за допомогою
	\cmd{vigr}). Деяк╕ з цих под╕й трапляються досить р╕дко, ╕
	виконувати ╖х треба дуже обережно. Наприклад, п╕сля зм╕ни
	╕мен╕ користувача, стара адреса електронно╖ пошти також
	перестане працювати для цього користувача, якщо Ви не створите
	псевдо для ново╖ адреси.\footnote{Можливо користувач
	зм╕нив(ла) ╕м'я п╕сля одруження, ╕ хоче заре╓струватися з
	новим ╕мененем.}
	
\section{Виключення користувача з╕ списку}

	Щоб виключити користувача, треба спочатку стерти вс╕ його
	файли, поштов╕ скрин╕, поштов╕ псевда, роботи, що знаходяться
	в друц╕, роботи \cmd{cron}, \cmd{at} та вс╕ ╕нш╕ посилання на
	цього користувача. П╕сля цього з╕тр╕ть в╕дпов╕дний рядок з
	\fn{/etc/passwd} та \cmd{/etc/group} (не забудьте стерти ╕м'я
	користувача з ус╕х ╕нших груп також). Можливо, спершу варто
	заборонити користування рахунком (див. дал╕) перш, н╕ж
	приступати до стирання файл╕в, щоб користувач не м╕г
	користуватися рахунком в той час, як Ви його стира╓те.

	Пам'ятайте також, що файли, що належать певному користувачев╕,
	можуть знаходитися також поза межами його домашньо╖
	директор╕╖. ╥х можна в╕дшукати за допомогою команди
	\cmd{find}. 
		%
\begin{quote}\tt
find / -user \textsl{╕м'я користувача}
\rm\end{quote}
		%
	Запам'ятайте однак, що ця команда буде працювати \emph{ дуже}
	довго на великих дисках. Якщо на Ваш╕й систем╕ змонтован╕
	також диски з мереж╕ (див. розд╕л~\ref{sec:NFS}), то будьте
	обережн╕, щоб не в╕дправити в см╕тник всю мережу або сервер. 

	Деяк╕ Л╕накси мають спец╕альн╕ команди для виконання описано╖
	д╕╖. Пошукайте в систем╕ \cmd{deluser} або \cmd{userdel}.
	Однак, все це дуже легко робиться вручну, ╕ кр╕м того команда
	може не робити всього, так, як треба.
	
\section{Тимчасова заборона користування рахунком}

	╤нколи бува╓ потр╕бно тимчасово зробити рахунок нед╕ючим, не
	знищуючи його зовс╕м. Наприклад, може користувач не сплачу╓ за
	користування рахунком, або системний адм╕н╕стратор може
	зап╕дозрити, що пароль користувача зломаний. 
	
	Найкращий спос╕б заборонити користування рахунком, це зм╕нити
	командну оболонку такого користувача на програму, яка буде
	всього-навсього друкувати пов╕домлення. При такому п╕дход╕
	будь-хто, пробуючи заре╓струватися в систем╕ в╕дразу ж
	зрозум╕╓, чому в╕н не може цього зробити. Програма може
	пов╕домляти користувачев╕, що в╕н ма╓ звернутися до системного
	адм╕н╕стратора щоб виправити проблему. 
	
	Кр╕м цього можливо також зм╕нити ╕м'я користувача чи пароль,
	але в цьому випадку користувач не знатиме, в чому
	справа. Збити з пантелику користувача означа╓ принести б╕льше
	клопоту самому соб╕.\footnote{Але це може бути \emph{ таке}
	задоволення, якщо Ви BOFH.}\begin{intnote}На жаль не вказаний тут
	\emph{ стандартний} метод заборони користування рахунком в
	Юн╕ксах: якщо попереду пароля в \fn{/etc/passwd} поставити
	з╕рочку ("<*">), то н╕хто не зможе заре╓струватися в систем╕ з
	цим ╕менем. Коли Вам треба буде знову дозволити користування
	цим рахунком, Вам просто треба буде стерти цю
	з╕рочку. Особисто мен╕ це уявля╓ться трохи кращим, н╕ж
	запам'ятовувати оболонку, яку вживав користувач до заборони
	рахунку ╕ повертати все на сво╖ м╕сця п╕зн╕ше. Адже п╕сля
	в╕дм╕ни заборони можна помилитися ╕ записати в цьому пол╕ не
	ту оболонку, яка потр╕бна користувачев╕ ╕ порушити тим самим
	купу скрипт╕в користувача. (Згадайте, що писалося про збитого
	з пантелику користувача ╕ уяв╕ть соб╕, що можна написати про
	збитого з пантелику системного адм╕н╕стратора.) Кр╕м того, чи
	варто писати користувачев╕, що в╕н ма╓ звертатися до
	системного адм╕н╕стратора, якщо його рахунок не працю╓, - а
	куди ж йому б╕долас╕ ще йти?!\end{intnote}
	
	Дуже прост╕ програмки, як╕ видають на екран пов╕домлення - це
	скрипти `tail'\intnote{tail - хв╕ст}:
		%
\begin{quote}\begin{verbatim}
#!/usr/bin/tail +2
This account has been closed due to a security breach.
Please call 555-1234 and wait for the men in black to arrive.
\intnote{Цей рахунок закрито через небезпеку злому. Зателефонуйте по
номеру 555-1234 ╕ чекайте на чолов╕ка в чорному.}
\end{verbatim}\end{quote}
		% 
	Перш╕ два символи (`\verb|#!|') пов╕домляють ядру, що залишок
	рядка ╓ командою, яку треба виконати над цим файлом. Команда
	\cmd{tail} в цьому випадку надруку╓ на стандартний вив╕д все
	кр╕м першого рядка.

	Якщо рахунок \texttt{biilg} п╕дозрю╓ться в небезпец╕ злому,
	системному адм╕н╕стратору сл╕д зробити щось таке:
		%
\begin{quote}\tt
\verb|#| \textsl{chsh -s /usr/local/lib/no-login/security billg} \\
\verb|#| \textsl{su - tester} \\
\verb|This account has been closed due to a security breach.| \\
\verb|Please call 555-1234 and wait for the men in black to arrive.| \\
\verb|#|
\rm\end{quote}
		%
	Команда \cmd{su} в цьому приклад╕ звичайно ж використову╓ться
	для перев╕рки, що все працю╓ так, як треба.

	Так╕ скрипти треба тримати в окрем╕й директор╕╖, щоб назви
	скрипт╕в не перем╕шувалися ╕з звичайними командами
	користувач╕в. 

%\section{Accounting}
%
%	\meta
%	sac et al
